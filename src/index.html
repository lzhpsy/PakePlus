<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¡åˆ’è¡¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            overflow: hidden;
        }

        .header {
            background: rgba(0, 122, 255, 0.1);
            backdrop-filter: blur(20px);
            color: #007AFF;
            padding: 30px;
            text-align: center;
            border-bottom: 1px solid rgba(0, 122, 255, 0.1);
        }

        .plan-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            padding: 0 30px;
            overflow-x: auto;
        }

        .plan-tab {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(0, 122, 255, 0.2);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-weight: 500;
            font-size: 14px;
            color: #007AFF;
            position: relative;
        }

        .plan-tab:hover {
            background: rgba(0, 122, 255, 0.1);
        }

        .plan-tab.active {
            background: #007AFF;
            color: white;
            box-shadow: 0 4px 15px rgba(0, 122, 255, 0.3);
        }

        .plan-tab .close-btn {
            margin-left: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            cursor: pointer;
        }

        .add-plan-btn {
            padding: 10px 16px;
            background: rgba(52, 199, 89, 0.1);
            border: 1px solid rgba(52, 199, 89, 0.3);
            border-radius: 20px;
            cursor: pointer;
            color: #34C759;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .add-plan-btn:hover {
            background: #34C759;
            color: white;
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1D1D1F;
        }

        .header p {
            font-size: 1rem;
            opacity: 0.7;
            color: #86868B;
            font-weight: 400;
        }

        .progress-section {
            background: rgba(248, 248, 248, 0.6);
            backdrop-filter: blur(20px);
            padding: 25px 30px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .progress-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .progress-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .progress-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
        }

        .progress-card.week1 { 
            background: rgba(0, 122, 255, 0.1); 
            border-left: 3px solid #007AFF;
        }
        .progress-card.week2 { 
            background: rgba(52, 199, 89, 0.1); 
            border-left: 3px solid #34C759;
        }
        .progress-card.week3 { 
            background: rgba(255, 149, 0, 0.1); 
            border-left: 3px solid #FF9500;
        }
        .progress-card.week4 { 
            background: rgba(255, 59, 48, 0.1); 
            border-left: 3px solid #FF3B30;
        }

        .progress-card h3 {
            color: #1D1D1F;
            margin-bottom: 12px;
            font-size: 1rem;
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(0,0,0,0.08);
            border-radius: 3px;
            overflow: hidden;
            margin: 12px 0;
        }

        .progress-fill {
            height: 100%;
            background: #007AFF;
            border-radius: 3px;
            transition: width 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .controls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 25px;
            align-items: center;
        }

        .controls-left {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .controls-right {
            margin-left: auto;
            display: flex;
            gap: 12px;
        }

        .add-task-btn {
            padding: 10px 18px;
            background: rgba(52, 199, 89, 0.1);
            border: 1px solid rgba(52, 199, 89, 0.3);
            border-radius: 20px;
            cursor: pointer;
            color: #34C759;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .add-task-btn:hover {
            background: #34C759;
            color: white;
            transform: translateY(-1px);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .modal h3 {
            color: #1D1D1F;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            color: #1D1D1F;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input[list] {
            background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" width="4" height="5"><path fill="%23666" d="M2 0L0 2h4zm0 5L0 3h4z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
            padding-right: 32px;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #007AFF;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            height: 80px;
        }

        .modal-buttons {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .btn {
            flex: 1;
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-size: 14px;
        }

        .btn-primary {
            background: #007AFF;
            color: white;
        }

        .btn-primary:hover {
            background: #0056CC;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: rgba(0, 0, 0, 0.05);
            color: #1D1D1F;
        }

        .btn-secondary:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .filter-btn {
            padding: 10px 18px;
            border: 1px solid rgba(0, 122, 255, 0.3);
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            font-weight: 500;
            font-size: 14px;
            color: #007AFF;
        }

        .filter-btn:hover {
            background: rgba(0, 122, 255, 0.1);
            transform: translateY(-1px);
        }

        .filter-btn.active {
            background: #007AFF;
            border-color: #007AFF;
            color: white;
            box-shadow: 0 4px 15px rgba(0, 122, 255, 0.3);
        }

        .search-box {
            flex: 1;
            min-width: 200px;
            padding: 12px 18px;
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 20px;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .search-box:focus {
            outline: none;
            border-color: #007AFF;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        .main-content {
            padding: 30px;
        }

        .phase-section {
            margin-bottom: 24px;
            border-radius: 20px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 25px rgba(0,0,0,0.06);
        }

        .phase-header {
            padding: 20px 25px;
            color: #1D1D1F;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .phase-header:hover {
            background: rgba(0, 122, 255, 0.05);
        }

        .phase-datacollection { 
            background: rgba(0, 122, 255, 0.08);
        }
        .phase-dataprocessing { 
            background: rgba(52, 199, 89, 0.08);
        }
        .phase-calculation { 
            background: rgba(255, 149, 0, 0.08);
        }
        .phase-others { 
            background: rgba(255, 59, 48, 0.08);
        }

        .toggle-icon {
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            color: #007AFF;
            font-size: 14px;
        }

        .phase-content {
            background: rgba(255, 255, 255, 0.5);
            max-height: 1000px;
            overflow: hidden;
            transition: max-height 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .phase-content.collapsed {
            max-height: 0;
        }

        .task-grid {
            display: grid;
            gap: 1px;
            background: rgba(0,0,0,0.05);
        }

        .task-row {
            display: grid;
            grid-template-columns: 50px 2fr 2fr 3fr;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
            border-radius: 0;
        }

        .task-row:hover {
            background: rgba(0, 122, 255, 0.03);
        }

        .task-row.completed {
            background: rgba(52, 199, 89, 0.08);
        }

        .task-cell {
            padding: 16px;
            border-right: 1px solid rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
        }

        .task-cell:last-child {
            border-right: none;
        }

        .checkbox {
            width: 22px;
            height: 22px;
            border: 2px solid #D1D1D6;
            border-radius: 6px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            background: rgba(255, 255, 255, 0.9);
        }

        .checkbox:hover {
            border-color: #007AFF;
            transform: scale(1.05);
        }

        .checkbox.checked {
            background: #007AFF;
            border-color: #007AFF;
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
        }

        .checkbox.checked::after {
            content: 'âœ“';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 12px;
            font-weight: 600;
        }

        .task-title {
            font-weight: 600;
            color: #1D1D1F;
            margin-bottom: 4px;
            font-size: 15px;
        }

        .task-desc {
            font-size: 13px;
            color: #86868B;
            font-weight: 400;
        }

        .data-source {
            font-size: 13px;
            color: #007AFF;
            background: rgba(0, 122, 255, 0.1);
            padding: 8px 12px;
            border-radius: 12px;
            display: inline-block;
            font-weight: 500;
            border: 1px solid rgba(0, 122, 255, 0.2);
        }

        .btn-remove {
            margin-left: 10px;
            color: #FF3B30;
            cursor: pointer;
            background: none;
            border: none;
            padding: 4px;
            border-radius: 4px;
            transition: background 0.3s ease;
        }

        .btn-remove:hover {
            background: rgba(255, 59, 48, 0.1);
        }

        .stats {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            min-width: 200px;
        }

        .stats h4 {
            color: #1D1D1F;
            margin-bottom: 16px;
            text-align: center;
            font-weight: 600;
            font-size: 16px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
            color: #86868B;
        }

        .stat-value {
            font-weight: 600;
            color: #007AFF;
        }

        @media (max-width: 768px) {
            .task-row {
                grid-template-columns: 40px 1fr;
                gap: 10px;
            }
            
            .task-cell:nth-child(3),
            .task-cell:nth-child(4) {
                grid-column: 1 / -1;
                border-top: 1px solid #e2e8f0;
                margin-top: 10px;
                padding-top: 10px;
            }

            .stats {
                position: static;
                margin-top: 30px;
            }

            .controls {
                flex-direction: column;
            }
        }

        .phase-btn {
            position: relative;
            display: inline-flex;
            align-items: center;
        }

        .phase-btn .delete-phase {
            margin-left: 6px;
            background: rgba(255, 59, 48, 0.1);
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            cursor: pointer;
            color: #FF3B30;
        }

        .phase-btn:hover .delete-phase {
            display: flex;
        }

        .schedule-container {
            display: grid;
            grid-template-columns: 80px repeat(7, 1fr);
            gap: 1px;
            background: rgba(0,0,0,0.05);
            border-radius: 8px;
            overflow: hidden;
            max-height: 500px;
            overflow-y: auto;
        }

        .schedule-header {
            background: rgba(0, 122, 255, 0.1);
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
            color: #007AFF;
        }

        .schedule-time-slot {
            background: rgba(248, 248, 248, 0.9);
            padding: 8px;
            text-align: center;
            font-size: 12px;
            color: #86868B;
            border-right: 1px solid rgba(0,0,0,0.1);
        }

        .schedule-cell {
            background: rgba(255, 255, 255, 0.9);
            min-height: 60px;
            padding: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .schedule-cell:hover {
            background: rgba(0, 122, 255, 0.05);
        }

        .schedule-cell.has-task {
            background: rgba(52, 199, 89, 0.1);
        }

        .schedule-task {
            background: #007AFF;
            color: white;
            padding: 4px 6px;
            border-radius: 6px;
            font-size: 11px;
            margin-bottom: 2px;
            cursor: pointer;
            position: relative;
            word-wrap: break-word;
        }

        .schedule-task.priority-high {
            background: #FF3B30;
        }

        .schedule-task.priority-medium {
            background: #FF9500;
        }

        .schedule-task.priority-low {
            background: #34C759;
        }

        .schedule-task:hover::after {
            content: 'Ã—';
            position: absolute;
            top: -2px;
            right: 2px;
            background: rgba(255,255,255,0.9);
            color: #FF3B30;
            border-radius: 50%;
            width: 14px;
            height: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
        }

        .week-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 10px;
        }

        .week-nav-btn {
            background: none;
            border: 1px solid rgba(0, 122, 255, 0.3);
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            color: #007AFF;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .week-nav-btn:hover {
            background: rgba(0, 122, 255, 0.1);
        }

        .current-week {
            font-weight: 600;
            color: #1D1D1F;
        }

        .time-picker-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }

        @media (max-width: 768px) {
            .schedule-container {
                grid-template-columns: 60px repeat(7, 1fr);
                font-size: 12px;
            }
            
            .schedule-header {
                padding: 8px 4px;
                font-size: 12px;
            }
            
            .schedule-time-slot {
                padding: 6px 4px;
                font-size: 11px;
            }
            
            .schedule-cell {
                min-height: 50px;
                padding: 2px;
            }
            
            .schedule-task {
                font-size: 10px;
                padding: 2px 4px;
            }
            
            .time-picker-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .week-navigation {
                flex-direction: column;
                gap: 10px;
            }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒŠ ç ”ç©¶è®¡åˆ’</h1>
            <p></p>
        </div>

        <div class="plan-tabs">
            <div class="plan-tab active" data-plan="default" onclick="switchPlan('default')">
                é»˜è®¤è®¡åˆ’
                <span class="close-btn" onclick="event.stopPropagation(); closePlan('default')" style="display: none;">Ã—</span>
            </div>
            <div class="add-plan-btn" onclick="addNewPlan()">+ æ–°å»ºè®¡åˆ’</div>
        </div>

        <div class="progress-section">
            <div class="progress-grid">
                <div class="progress-card week1">
                    <h3>ç¬¬ä¸€å‘¨ - æ•°æ®æ”¶é›†</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="week1-progress"></div>
                    </div>
                    <div><span id="week1-completed">0</span> / <span id="week1-total">13</span> é¡¹ä»»åŠ¡</div>
                </div>
                <div class="progress-card week2">
                    <h3>ç¬¬äºŒ-ä¸‰å‘¨ - æ•°æ®å¤„ç†</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="week2-progress"></div>
                    </div>
                    <div><span id="week2-completed">0</span> / <span id="week2-total">18</span> é¡¹ä»»åŠ¡</div>
                </div>
                <div class="progress-card week3">
                    <h3>ç¬¬å››å‘¨ - æŒ‡æ ‡è®¡ç®—</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="week3-progress"></div>
                    </div>
                    <div><span id="week3-completed">0</span> / <span id="week3-total">5</span> é¡¹ä»»åŠ¡</div>
                </div>
                <div class="progress-card week4">
                    <h3>å…¶ä»–ä»»åŠ¡</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="week4-progress"></div>
                    </div>
                    <div><span id="week4-completed">0</span> / <span id="week4-total">4</span> é¡¹ä»»åŠ¡</div>
                </div>
            </div>

            <div class="controls">
                <div class="controls-left">
                    <button class="filter-btn static active" onclick="filterTasks('all')">å…¨éƒ¨ä»»åŠ¡</button>
                    <button class="filter-btn static" onclick="filterTasks('completed')">å·²å®Œæˆ</button>
                    <button class="filter-btn static" onclick="filterTasks('pending')">å¾…å®Œæˆ</button>
                    <!-- åŠ¨æ€é˜¶æ®µæŒ‰é’®å°†åœ¨è¿™é‡Œæ’å…¥ -->
                    <input type="text" class="search-box" placeholder="æœç´¢ä»»åŠ¡..." oninput="searchTasks(this.value)">
                </div>
                <div class="controls-right">
                    <button class="add-task-btn" onclick="showAddTaskModal()">+ æ·»åŠ ä»»åŠ¡</button>
                </div>
            </div>
        </div>

        <div class="main-content">
            <!-- æ—¥ç¨‹è¡¨åŒºåŸŸ -->
            <div class="schedule-section" style="margin-bottom: 30px;">
                <div class="schedule-header-section" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="color: #1D1D1F; font-size: 1.3rem; font-weight: 600;">ğŸ“… æœ¬å‘¨æ—¶é—´å®‰æ’</h2>
                    <div class="week-navigation">
                        <button class="week-nav-btn" onclick="changeWeek(-1)">â† ä¸Šä¸€å‘¨</button>
                        <div class="current-week" id="currentWeekDisplay">2025å¹´6æœˆ2æ—¥ - 6æœˆ8æ—¥</div>
                        <button class="week-nav-btn" onclick="changeWeek(1)">ä¸‹ä¸€å‘¨ â†’</button>
                    </div>
                    <button class="add-task-btn" onclick="showAddScheduleModal()">+ æ·»åŠ æ—¶é—´å®‰æ’</button>
                </div>
                
                <div class="schedule-container" id="scheduleContainer">
                    <!-- è¯¾ç¨‹è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div style="margin-top: 15px; padding: 10px; background: rgba(0, 122, 255, 0.05); border-radius: 8px; font-size: 14px; color: #86868B;">
                    ğŸ’¡ <strong>ä½¿ç”¨æç¤ºï¼š</strong>ç‚¹å‡»ä»»æ„æ—¶é—´æ ¼å­æ·»åŠ å®‰æ’ | æ‚¬åœä»»åŠ¡å¯åˆ é™¤ | ä¸åŒé¢œè‰²è¡¨ç¤ºä¸åŒä¼˜å…ˆçº§
                </div>
            </div>

            <!-- ä»»åŠ¡ç®¡ç†åŒºåŸŸ -->
            <!-- æ•°æ®æ”¶é›†é˜¶æ®µ -->
            <div class="phase-section" data-phase="datacollection">
                <div class="phase-header phase-datacollection" onclick="togglePhase(this)">
                    <span>ğŸ“Š æ•°æ®æ”¶é›† (ç¬¬ä¸€å‘¨)</span>
                    <span class="toggle-icon">â–¼</span>
                </div>
                <div class="phase-content">
                    <div class="task-grid">
                        <div class="task-row" data-week="1">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">NDVIæ•°æ®</div>
                                    <div class="task-desc">è·å–æ¤è¢«æŒ‡æ•°æ•°æ®ç”¨äºæ¤è¢«è¦†ç›–åº¦è®¡ç®—</div>
                                </div>
                            </div>
                            <div class="task-cell">é¥æ„Ÿå½±åƒæ•°æ®</div>
                            <div class="task-cell"><span class="data-source">Landsat 8/9, Sentinel-2</span></div>
                        </div>
                        <div class="task-row" data-week="1">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">å¤œé—´ç¯å…‰æ•°æ®</div>
                                    <div class="task-desc">äººç±»æ´»åŠ¨å¼ºåº¦è¯„ä»·çš„æ ¸å¿ƒæ•°æ®</div>
                                </div>
                            </div>
                            <div class="task-cell">é¥æ„Ÿå½±åƒæ•°æ®</div>
                            <div class="task-cell"><span class="data-source">NPP-VIIRS</span></div>
                        </div>
                        <div class="task-row" data-week="1">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">åœŸåœ°åˆ©ç”¨/è¦†ç›–æ•°æ®</div>
                                    <div class="task-desc">åœŸåœ°åˆ©ç”¨ç°çŠ¶åˆ†æåŸºç¡€æ•°æ®</div>
                                </div>
                            </div>
                            <div class="task-cell">ç©ºé—´çŸ¢é‡æ•°æ®</div>
                            <div class="task-cell"><span class="data-source">ä¸­ç§‘é™¢åœŸåœ°åˆ©ç”¨æ•°æ®</span></div>
                        </div>
                        <div class="task-row" data-week="1">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">æ°´ä½“ç©ºé—´æ•°æ®</div>
                                    <div class="task-desc">æ°´ä½“å¯†åº¦è®¡ç®—çš„ç©ºé—´åŸºç¡€</div>
                                </div>
                            </div>
                            <div class="task-cell">ç©ºé—´çŸ¢é‡æ•°æ®</div>
                            <div class="task-cell"><span class="data-source">OSM, å›½å®¶åŸºç¡€åœ°ç†ä¿¡æ¯</span></div>
                        </div>
                        <div class="task-row" data-week="1">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">äº¤é€šç½‘ç»œæ•°æ®</div>
                                    <div class="task-desc">äº¤é€šå¯è¾¾æ€§åˆ†ææ•°æ®</div>
                                </div>
                            </div>
                            <div class="task-cell">ç©ºé—´çŸ¢é‡æ•°æ®</div>
                            <div class="task-cell"><span class="data-source">OSM, ç›¸å…³å«æ˜Ÿå½±åƒè·¯ç½‘æ³¨è®°</span></div>
                        </div>
                        <div class="task-row" data-week="1">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">DEMæ•°æ®</div>
                                    <div class="task-desc">åœ°å½¢åˆ†æå’Œæ°´æ–‡å»ºæ¨¡</div>
                                </div>
                            </div>
                            <div class="task-cell">æ•°å­—é«˜ç¨‹æ¨¡å‹</div>
                            <div class="task-cell"><span class="data-source">GDEM</span></div>
                        </div>
                        <div class="task-row" data-week="1">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">äººå£ç¤¾ä¼šæ•°æ®</div>
                                    <div class="task-desc">æœåŠ¡åŠŸèƒ½è¯„ä»·çš„ç¤¾ä¼šç»æµåŸºç¡€</div>
                                </div>
                            </div>
                            <div class="task-cell">ç»Ÿè®¡æ•°æ®</div>
                            <div class="task-cell"><span class="data-source">POPäººå£æ•°æ®ï¼Œæ‘é•‡äººå£æ•°æ®</span></div>
                        </div>
                        <div class="task-row" data-week="1">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">è¡Œæ”¿åŒºåˆ’æ•°æ®</div>
                                    <div class="task-desc">ç©ºé—´ç»Ÿè®¡åˆ†æå•å…ƒ</div>
                                </div>
                            </div>
                            <div class="task-cell">ç©ºé—´è¾¹ç•Œæ•°æ®</div>
                            <div class="task-cell"><span class="data-source">å¿çº§è‡ªæ²»åŒºå¿çº§ï¼Œæå–å››ä¸ªå…³é”®å¿åŒºæ•°æ®</span></div>
                        </div>
                        <div class="task-row" data-week="1">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">æ™¯è§‚ä¸æ–‡åŒ–æ•°æ®</div>
                                    <div class="task-desc">æ–‡åŒ–æœåŠ¡åŠŸèƒ½è¯„ä»·</div>
                                </div>
                            </div>
                            <div class="task-cell">POIæ•°æ®</div>
                            <div class="task-cell"><span class="data-source">æ–‡ç‰©å±€ï¼Œæ–‡åŒ–æ—…æ¸¸éƒ¨é—¨å¼€æ”¾æ•°æ®</span></div>
                        </div>
                        <div class="task-row" data-week="1">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">æ—…æ¸¸æ™¯ç‚¹æ•°æ®</div>
                                    <div class="task-desc">ä¼‘é—²å¨±ä¹åŠŸèƒ½è¯„ä»·</div>
                                </div>
                            </div>
                            <div class="task-cell">POIæ•°æ®</div>
                            <div class="task-cell"><span class="data-source">æ—…æ¸¸éƒ¨é—¨ï¼Œå¼€æ”¾åœ°ç†æ•°æ®ï¼ŒPOI</span></div>
                        </div>
                        <div class="task-row" data-week="1">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">ç”Ÿæ€ä¿æŠ¤å·¥ç¨‹</div>
                                    <div class="task-desc">ç”Ÿæ€ä¿æŠ¤ä¸ç®¡ç†åˆ†æ</div>
                                </div>
                            </div>
                            <div class="task-cell">æ”¿ç­–æ–‡ä»¶</div>
                            <div class="task-cell"><span class="data-source">æ”¿åºœå…¬å¼€ä¿¡æ¯</span></div>
                        </div>
                        <div class="task-row" data-week="1">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">æ‘åº„èšè½æ•°æ®</div>
                                    <div class="task-desc">èšè½åˆ†å¸ƒä¸ç©ºé—´åˆ†æ</div>
                                </div>
                            </div>
                            <div class="task-cell">POIæ•°æ®</div>
                            <div class="task-cell"><span class="data-source">å¼€æ”¾åœ°ç†æ•°æ®ï¼ŒPOIï¼Œé«˜å¾·ç­‰</span></div>
                        </div>
                        <div class="task-row" data-week="1">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">ç§‘ç ”ç›¸å…³å»ºç­‘ã€æ‘åº„ç­‰</div>
                                    <div class="task-desc">ç§‘å­¦ç ”ç©¶åŠŸèƒ½è¯„ä»·</div>
                                </div>
                            </div>
                            <div class="task-cell">POIæ•°æ®</div>
                            <div class="task-cell"><span class="data-source">POIï¼Œå…¬å¼€æ•°æ®</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ•°æ®å¤„ç†é˜¶æ®µ -->
            <div class="phase-section" data-phase="dataprocessing">
                <div class="phase-header phase-dataprocessing" onclick="togglePhase(this)">
                    <span>âš™ï¸ æ•°æ®å¤„ç† (ç¬¬äºŒ-ä¸‰å‘¨)</span>
                    <span class="toggle-icon">â–¼</span>
                </div>
                <div class="phase-content">
                    <div class="task-grid">
                        <div class="task-row" data-week="2">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">æ•°æ®é¢„å¤„ç†</div>
                                    <div class="task-desc">ç»Ÿä¸€åæ ‡ç³»ï¼Œç©ºé—´é…å‡†ï¼Œè´¨é‡æ§åˆ¶</div>
                                </div>
                            </div>
                            <div class="task-cell">ç©ºé—´æ•°æ®æ ‡å‡†åŒ–</div>
                            <div class="task-cell"><span class="data-source">ç»Ÿä¸€åæ ‡ç³»(WGS1984)ï¼Œç©ºé—´åˆ†è¾¨ç‡é‡é‡‡æ ·</span></div>
                        </div>
                        <div class="task-row" data-week="2">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">æ¤è¢«è¦†ç›–åº¦è®¡ç®—</div>
                                    <div class="task-desc">åŸºäºNDVIè®¡ç®—æ¤è¢«è¦†ç›–åº¦åˆ†çº§</div>
                                </div>
                            </div>
                            <div class="task-cell">é¥æ„Ÿæ•°æ®åˆ†æ</div>
                            <div class="task-cell"><span class="data-source">åŸºäºNDVIæ•°æ®è®¡ç®—æ¤è¢«è¦†ç›–åº¦</span></div>
                        </div>
                        <div class="task-row" data-week="2">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">äººç±»æ´»åŠ¨å¼ºåº¦è®¡ç®—</div>
                                    <div class="task-desc">åŸºäºå¤œé—´ç¯å…‰æ•°æ®çš„æ´»åŠ¨å¼ºåº¦æŒ‡æ•°</div>
                                </div>
                            </div>
                            <div class="task-cell">é¥æ„Ÿæ•°æ®åˆ†æ</div>
                            <div class="task-cell"><span class="data-source">åŸºäºå¤œé—´ç¯å…‰æ•°æ®æ ‡å‡†åŒ–å¤„ç†</span></div>
                        </div>
                        <div class="task-row" data-week="2">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">æ°´ä½“å¯†åº¦è®¡ç®—</div>
                                    <div class="task-desc">è®¡ç®—å•ä½é¢ç§¯æ°´ä½“é•¿åº¦å¯†åº¦</div>
                                </div>
                            </div>
                            <div class="task-cell">ç©ºé—´åˆ†æ</div>
                            <div class="task-cell"><span class="data-source">è®¡ç®—å•ä½é¢ç§¯æ°´ä½“é•¿åº¦(km/kmÂ²)</span></div>
                        </div>
                        <div class="task-row" data-week="2">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">å¯è¾¾æ€§åˆ†æ</div>
                                    <div class="task-desc">äº¤é€šå¯è¾¾æ€§å’ŒæœåŠ¡å¯è¾¾æ€§åˆ†æ</div>
                                </div>
                            </div>
                            <div class="task-cell">ç½‘ç»œåˆ†æ</div>
                            <div class="task-cell"><span class="data-source">è®¡ç®—åˆ°è·ç¦»è·¯ç½‘è·ç¦»å’Œæ˜“è¾¾æ€§</span></div>
                        </div>
                        <div class="task-row" data-week="2">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">åœŸåœ°åˆ©ç”¨ç°çŠ¶åˆ†æ</div>
                                    <div class="task-desc">å„ç±»åœŸåœ°åˆ©ç”¨ç±»å‹ç»Ÿè®¡åˆ†æ</div>
                                </div>
                            </div>
                            <div class="task-cell">åˆ†ç±»ç»Ÿè®¡</div>
                            <div class="task-cell"><span class="data-source">å„ç±»æ™¯è§‚ç±»å‹è¯†åˆ«å’Œåˆ†ç±»</span></div>
                        </div>
                        <div class="task-row" data-week="2">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">æ™¯è§‚å¯è§†åº¦åˆ†æ</div>
                                    <div class="task-desc">åŸºäºDEMçš„è§†åŸŸåˆ†æ</div>
                                </div>
                            </div>
                            <div class="task-cell">ç©ºé—´åˆ†æ</div>
                            <div class="task-cell"><span class="data-source">æ ¹æ®åœ°å½¢æ•°æ®ç”Ÿæˆæ™¯è§‚å¯è§†åº¦</span></div>
                        </div>
                        <div class="task-row" data-week="2">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">å†œäº§å“ä¾›ç»™é‡</div>
                                    <div class="task-desc">åŸºäºé¥æ„Ÿçš„å†œä¸šç”Ÿäº§åŠ›è¯„ä¼°</div>
                                </div>
                            </div>
                            <div class="task-cell">äº§é‡ä¼°ç®—</div>
                            <div class="task-cell"><span class="data-source">ä½¿ç”¨NDVIæ°”è±¡æ•°æ®è®¡ç®—</span></div>
                        </div>
                        <div class="task-row" data-week="2">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">æ°´ä½“é€‚å®œåº¦</div>
                                    <div class="task-desc">æ°´ä½“ç”Ÿæ€é€‚å®œæ€§è¯„ä»·</div>
                                </div>
                            </div>
                            <div class="task-cell">é€‚å®œæ€§è¯„ä»·</div>
                            <div class="task-cell"><span class="data-source">æ ¹æ®æ°´ä½“è¿›è¡Œé€‚å®œåº¦åˆ†æ</span></div>
                        </div>
                        <div class="task-row" data-week="2">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">åœ°å½¢å¤æ‚åº¦</div>
                                    <div class="task-desc">åœ°å½¢èµ·ä¼åº¦å’Œå¤æ‚æ€§è®¡ç®—</div>
                                </div>
                            </div>
                            <div class="task-cell">åœ°å½¢åˆ†æ</div>
                            <div class="task-cell"><span class="data-source">ä½¿ç”¨DEMè¿›è¡Œè®¡ç®—</span></div>
                        </div>
                        <div class="task-row" data-week="2">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">åœŸå£¤è´¨é‡è¯„ä»·</div>
                                    <div class="task-desc">åœŸå£¤è´¨é‡æŒ‡æ ‡è®¡ç®—</div>
                                </div>
                            </div>
                            <div class="task-cell">è´¨é‡è¯„ä»·</div>
                            <div class="task-cell"><span class="data-source">æ ¹æ®åœŸå£¤pHç­‰è®¡ç®—è´¨é‡</span></div>
                        </div>
                        <div class="task-row" data-week="2">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">æ—…æ¸¸è®¾æ–½å¯†åº¦</div>
                                    <div class="task-desc">æ—…æ¸¸åŸºç¡€è®¾æ–½ç©ºé—´å¯†åº¦</div>
                                </div>
                            </div>
                            <div class="task-cell">å¯†åº¦è®¡ç®—</div>
                            <div class="task-cell"><span class="data-source">æ—…æ¸¸è®¾æ–½å¯†åº¦æ•°æ®/é¢ç§¯(ä¸ª/kmÂ²)</span></div>
                        </div>
                        <div class="task-row" data-week="2">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">é¢†åŸŸæ™¯ç‚¹èµ„æº</div>
                                    <div class="task-desc">å‘¨è¾¹æ™¯ç‚¹èµ„æºè¯„ä»·</div>
                                </div>
                            </div>
                            <div class="task-cell">èµ„æºè¯„ä»·</div>
                            <div class="task-cell"><span class="data-source">æ ¹æ®å‘¨è¾¹æ™¯ç‚¹æ•°é‡è®¡ç®—</span></div>
                        </div>
                        <div class="task-row" data-week="2">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">èšè½å¯è¾¾æ€§</div>
                                    <div class="task-desc">èšè½äº¤é€šå¯è¾¾æ€§åˆ†æ</div>
                                </div>
                            </div>
                            <div class="task-cell">å¯è¾¾æ€§åˆ†æ</div>
                            <div class="task-cell"><span class="data-source">æ ¹æ®è·ç¦»æ‘é•‡çš„è·ç¦»è®¡ç®—</span></div>
                        </div>
                        <div class="task-row" data-week="2">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">ç”Ÿç‰©å¤šæ ·æ€§æŒ‡æ•°è®¡ç®—</div>
                                    <div class="task-desc">åŸºäºæ™¯è§‚å¤šæ ·æ€§çš„ç”Ÿç‰©å¤šæ ·æ€§</div>
                                </div>
                            </div>
                            <div class="task-cell">å¤šæ ·æ€§åˆ†æ</div>
                            <div class="task-cell"><span class="data-source">æ™¯è§‚å¼‚è´¨æ€§è®¡ç®—ç”Ÿç‰©å¤šæ ·æ€§</span></div>
                        </div>
                        <div class="task-row" data-week="2">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">æ°”è±¡ç«™ç‚¹ã€ç§‘ç ”ç«™ç‚¹å¯†åº¦</div>
                                    <div class="task-desc">ç§‘ç ”åŸºç¡€è®¾æ–½å¯†åº¦è¯„ä»·</div>
                                </div>
                            </div>
                            <div class="task-cell">å¯†åº¦è®¡ç®—</div>
                            <div class="task-cell"><span class="data-source">ç§‘ç ”è®¾æ–½å¯†åº¦</span></div>
                        </div>
                        <div class="task-row" data-week="2">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">å¾„æµé‡åˆ†å¸ƒ</div>
                                    <div class="task-desc">æ°´æ–‡å¾„æµç©ºé—´åˆ†å¸ƒåˆ†æ</div>
                                </div>
                            </div>
                            <div class="task-cell">æ°´æ–‡åˆ†æ</div>
                            <div class="task-cell"><span class="data-source">åŸºäºé™æ°´æ•°æ®å’Œåœ°å½¢</span></div>
                        </div>
                        <div class="task-row" data-week="2">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">å¾„æµæºèŒƒå›´ç½‘æ ¼</div>
                                    <div class="task-desc">æ°´ç½‘å¾„æµèŒƒå›´ç½‘æ ¼åˆ†æ</div>
                                </div>
                            </div>
                            <div class="task-cell">ç½‘ç»œåˆ†æ</div>
                            <div class="task-cell"><span class="data-source">æ°´ç½‘è¿é€šæ€§åˆ†æ</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æŒ‡æ ‡è®¡ç®—é˜¶æ®µ -->
            <div class="phase-section" data-phase="calculation">
                <div class="phase-header phase-calculation" onclick="togglePhase(this)">
                    <span>ğŸ“ˆ æŒ‡æ ‡è®¡ç®— (ç¬¬å››å‘¨)</span>
                    <span class="toggle-icon">â–¼</span>
                </div>
                <div class="phase-content">
                    <div class="task-grid">
                        <div class="task-row" data-week="3">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">æœåŠ¡åŠŸèƒ½é€‚å®œæ€§è¯„ä»·ï¼ˆè°ƒèŠ‚æœåŠ¡ï¼‰</div>
                                    <div class="task-desc">ç”Ÿæ€è°ƒèŠ‚æœåŠ¡åŠŸèƒ½ç»¼åˆè¯„ä»·</div>
                                </div>
                            </div>
                            <div class="task-cell">ç»¼åˆè¯„ä»·</div>
                            <div class="task-cell"><span class="data-source">æ°´æºæ¶µå…»ã€æ°´åœŸä¿æŒã€å›ºç¢³ã€æ´ªç¼“ã€æ»æ°´ä¾›ç»™</span></div>
                        </div>
                        <div class="task-row" data-week="3">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">æœåŠ¡åŠŸèƒ½é€‚å®œæ€§è¯„ä»·ï¼ˆä¾›ç»™æœåŠ¡ï¼‰</div>
                                    <div class="task-desc">ç‰©è´¨ä¾›ç»™æœåŠ¡åŠŸèƒ½è¯„ä»·</div>
                                </div>
                            </div>
                            <div class="task-cell">ä¾›ç»™è¯„ä»·</div>
                            <div class="task-cell"><span class="data-source">æ·¡æ°´ä¾›ç»™ã€å†œäº§å“ä¾›ç»™</span></div>
                        </div>
                        <div class="task-row" data-week="3">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">æ–‡åŒ–æœåŠ¡</div>
                                    <div class="task-desc">æ–‡åŒ–ã€æ•™è‚²ã€å¨±ä¹æœåŠ¡è¯„ä»·</div>
                                </div>
                            </div>
                            <div class="task-cell">æ–‡åŒ–è¯„ä»·</div>
                            <div class="task-cell"><span class="data-source">æ™¯è§‚ç¾å­¦ã€ä¼‘é—²æ¸¸æ†©ã€ç§‘å­¦ç ”ç©¶</span></div>
                        </div>
                        <div class="task-row" data-week="3">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">è°ƒèŠ‚æœåŠ¡èµ„æºåˆ©ç”¨ç°çŠ¶</div>
                                    <div class="task-desc">è°ƒèŠ‚æœåŠ¡åŠŸèƒ½åˆ©ç”¨çŠ¶å†µè¯„ä¼°</div>
                                </div>
                            </div>
                            <div class="task-cell">åˆ©ç”¨è¯„ä»·</div>
                            <div class="task-cell"><span class="data-source">ç”Ÿæ€è°ƒèŠ‚æœåŠ¡ç°çŠ¶åˆ†æ</span></div>
                        </div>
                        <div class="task-row" data-week="3">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">ä¾›ç»™æœåŠ¡èµ„æºåˆ©ç”¨ç°çŠ¶</div>
                                    <div class="task-desc">ä¾›ç»™æœåŠ¡åŠŸèƒ½åˆ©ç”¨çŠ¶å†µè¯„ä¼°</div>
                                </div>
                            </div>
                            <div class="task-cell">åˆ©ç”¨è¯„ä»·</div>
                            <div class="task-cell"><span class="data-source">ç‰©è´¨ä¾›ç»™æœåŠ¡ç°çŠ¶åˆ†æ</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å…¶ä»–ä»»åŠ¡ -->
            <div class="phase-section" data-phase="others">
                <div class="phase-header phase-others" onclick="togglePhase(this)">
                    <span>ğŸ”§ å…¶ä»–ä»»åŠ¡</span>
                    <span class="toggle-icon">â–¼</span>
                </div>
                <div class="phase-content">
                    <div class="task-grid">
                        <div class="task-row" data-week="4">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">æ£®æ—ç±»å‹ï¼ˆå…¬ç›Šæ—ã€å•†å“æ—ï¼‰</div>
                                    <div class="task-desc">æ£®æ—åˆ†ç±»ç®¡ç†æ•°æ®æ”¶é›†</div>
                                </div>
                            </div>
                            <div class="task-cell">æ—ä¸šæ•°æ®</div>
                            <div class="task-cell"><span class="data-source">æ—ä¸šéƒ¨é—¨åˆ†ç±»æ•°æ®</span></div>
                        </div>
                        <div class="task-row" data-week="4">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">åœŸåœ°æƒå±æ€§è´¨</div>
                                    <div class="task-desc">åœŸåœ°æ‰€æœ‰æƒå’Œä½¿ç”¨æƒåˆ†æ</div>
                                </div>
                            </div>
                            <div class="task-cell">æƒå±æ•°æ®</div>
                            <div class="task-cell"><span class="data-source">éœ€è¦å»æµ‹ç»˜é™¢è·å–</span></div>
                        </div>
                        <div class="task-row" data-week="4">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">ç®¡æ§å¼ºåº¦</div>
                                    <div class="task-desc">ç”Ÿæ€ä¿æŠ¤ç®¡æ§å¼ºåº¦è¯„ä»·</div>
                                </div>
                            </div>
                            <div class="task-cell">ç®¡æ§è¯„ä»·</div>
                            <div class="task-cell"><span class="data-source">ä¿æŠ¤åŒºç®¡ç†æ”¿ç­–åˆ†æ</span></div>
                        </div>
                        <div class="task-row" data-week="4">
                            <div class="task-cell"><div class="checkbox" onclick="toggleTask(this)"></div></div>
                            <div class="task-cell">
                                <div>
                                    <div class="task-title">æ°¸ä¹…åŸºæœ¬å†œç”°è¦†ç›–ç‡</div>
                                    <div class="task-desc">æ°¸ä¹…åŸºæœ¬å†œç”°ä¿æŠ¤åŒºåŸŸè¦†ç›–ç‡è®¡ç®—</div>
                                </div>
                            </div>
                            <div class="task-cell">è¦†ç›–ç‡åˆ†æ</div>
                            <div class="task-cell"><span class="data-source">å›½åœŸèµ„æºéƒ¨é—¨å†œç”°ä¿æŠ¤æ•°æ®</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ ä»»åŠ¡æ¨¡æ€æ¡† -->
    <div class="modal" id="addTaskModal">
        <div class="modal-content">
            <h3>æ·»åŠ æ–°ä»»åŠ¡</h3>
            <form id="addTaskForm">
                <div class="form-group">
                    <label for="taskTitle">ä»»åŠ¡åç§°</label>
                    <input type="text" id="taskTitle" required>
                </div>
                <div class="form-group">
                    <label for="taskDesc">ä»»åŠ¡æè¿°</label>
                    <textarea id="taskDesc" placeholder="è¯¦ç»†æè¿°ä»»åŠ¡å†…å®¹..."></textarea>
                </div>
                <div class="form-group">
                    <label for="taskPhase">æ‰€å±é˜¶æ®µ</label>
                    <input type="text" id="taskPhase" list="phaseOptions" required placeholder="é€‰æ‹©æˆ–è¾“å…¥è‡ªå®šä¹‰é˜¶æ®µ">
                    <datalist id="phaseOptions">
                        <option value="æ•°æ®æ”¶é›†">æ•°æ®æ”¶é›†</option>
                        <option value="æ•°æ®å¤„ç†">æ•°æ®å¤„ç†</option>
                        <option value="æŒ‡æ ‡è®¡ç®—">æŒ‡æ ‡è®¡ç®—</option>
                        <option value="å…¶ä»–ä»»åŠ¡">å…¶ä»–ä»»åŠ¡</option>
                    </datalist>
                </div>
                <div class="form-group">
                    <label for="taskWeek">æ—¶é—´å®‰æ’</label>
                    <input type="text" id="taskWeek" list="weekOptions" required placeholder="é€‰æ‹©æˆ–è¾“å…¥è‡ªå®šä¹‰æ—¶é—´">
                    <datalist id="weekOptions">
                        <option value="ç¬¬ä¸€å‘¨">ç¬¬ä¸€å‘¨</option>
                        <option value="ç¬¬äºŒ-ä¸‰å‘¨">ç¬¬äºŒ-ä¸‰å‘¨</option>
                        <option value="ç¬¬å››å‘¨">ç¬¬å››å‘¨</option>
                        <option value="å…¶ä»–æ—¶é—´">å…¶ä»–æ—¶é—´</option>
                    </datalist>
                </div>
                <div class="form-group">
                    <label for="taskType">æ•°æ®ç±»å‹</label>
                    <input type="text" id="taskType" placeholder="å¦‚ï¼šé¥æ„Ÿæ•°æ®ã€ç»Ÿè®¡æ•°æ®ç­‰">
                </div>
                <div class="form-group">
                    <label for="taskSource">æ•°æ®æº</label>
                    <input type="text" id="taskSource" placeholder="æ•°æ®æ¥æºè¯´æ˜">
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn btn-secondary" onclick="hideAddTaskModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary">æ·»åŠ ä»»åŠ¡</button>
                </div>
            </form>
        </div>
    </div>

    <!-- æ·»åŠ æ—¥ç¨‹æ¨¡æ€æ¡† -->
    <div class="modal" id="addScheduleModal">
        <div class="modal-content">
            <h3>æ·»åŠ æ—¶é—´å®‰æ’</h3>
            <form id="addScheduleForm">
                <div class="form-group">
                    <label for="scheduleTitle">ä»»åŠ¡åç§°</label>
                    <input type="text" id="scheduleTitle" required placeholder="å¦‚ï¼šæ•°æ®æ”¶é›†ã€ä¼šè®®è®¨è®ºç­‰">
                </div>
                <div class="form-group">
                    <label for="scheduleDesc">ä»»åŠ¡æè¿°</label>
                    <textarea id="scheduleDesc" placeholder="è¯¦ç»†æè¿°ä»»åŠ¡å†…å®¹..."></textarea>
                </div>
                <div class="form-group">
                    <label>æ—¶é—´å®‰æ’</label>
                    <div class="time-picker-grid">
                        <select id="scheduleWeekday" required>
                            <option value="1">å‘¨ä¸€</option>
                            <option value="2">å‘¨äºŒ</option>
                            <option value="3">å‘¨ä¸‰</option>
                            <option value="4">å‘¨å››</option>
                            <option value="5">å‘¨äº”</option>
                            <option value="6">å‘¨å…­</option>
                            <option value="0">å‘¨æ—¥</option>
                        </select>
                        <input type="time" id="scheduleStartTime" required value="09:00">
                        <input type="time" id="scheduleEndTime" required value="10:00">
                    </div>
                </div>
                <div class="form-group">
                    <label for="schedulePriority">ä¼˜å…ˆçº§</label>
                    <select id="schedulePriority">
                        <option value="low">ä½ä¼˜å…ˆçº§</option>
                        <option value="medium" selected>ä¸­ä¼˜å…ˆçº§</option>
                        <option value="high">é«˜ä¼˜å…ˆçº§</option>
                    </select>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn btn-secondary" onclick="hideAddScheduleModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary">æ·»åŠ å®‰æ’</button>
                </div>
            </form>
        </div>
    </div>

    <!-- æ–°å»ºè®¡åˆ’æ¨¡æ€æ¡† -->
    <div class="modal" id="addPlanModal">
        <div class="modal-content">
            <h3>æ–°å»ºç ”ç©¶è®¡åˆ’</h3>
            <form id="addPlanForm">
                <div class="form-group">
                    <label for="planName">è®¡åˆ’åç§°</label>
                    <input type="text" id="planName" required placeholder="å¦‚ï¼šç”Ÿæ€ä¿®å¤ç ”ç©¶è®¡åˆ’">
                </div>
                <div class="form-group">
                    <label for="planDesc">è®¡åˆ’æè¿°</label>
                    <textarea id="planDesc" placeholder="ç®€è¦æè¿°ç ”ç©¶è®¡åˆ’çš„ç›®æ ‡å’Œå†…å®¹..."></textarea>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn btn-secondary" onclick="hidePlanModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary">åˆ›å»ºè®¡åˆ’</button>
                </div>
            </form>
        </div>
    </div>

    <div class="stats">
        <h4>ğŸ“Š æ€»ä½“è¿›åº¦</h4>
        <div class="stat-item">
            <span>æ€»ä»»åŠ¡æ•°:</span>
            <span class="stat-value" id="total-tasks">40</span>
        </div>
        <div class="stat-item">
            <span>å·²å®Œæˆ:</span>
            <span class="stat-value" id="completed-tasks">0</span>
        </div>
        <div class="stat-item">
            <span>å¾…å®Œæˆ:</span>
            <span class="stat-value" id="pending-tasks">40</span>
        </div>
        <div class="stat-item">
            <span>å®Œæˆç‡:</span>
            <span class="stat-value" id="completion-rate">0%</span>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let plans = {};
        let currentPlan = 'default';
        let currentFilter = 'all';
        let taskIdCounter = 1000;
        let schedules = {};
        let currentWeekStart = new Date();
        let selectedTimeSlot = null;

        // åˆå§‹åŒ–å½“å‰å‘¨çš„å¼€å§‹æ—¥æœŸï¼ˆå‘¨ä¸€ï¼‰
        function initCurrentWeek() {
            const today = new Date();
            const dayOfWeek = today.getDay();
            const mondayOffset = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
            currentWeekStart = new Date(today);
            currentWeekStart.setDate(today.getDate() + mondayOffset);
        }

        // åˆå§‹åŒ–é»˜è®¤è®¡åˆ’
        function initializeDefaultPlan() {
            plans['default'] = {
                name: 'é»˜è®¤è®¡åˆ’',
                description: 'æ°´åŸŸç”Ÿæ€ç³»ç»ŸæœåŠ¡åŠŸèƒ½è¯„ä»·ç ”ç©¶',
                tasks: []
            };
            
            // åˆå§‹åŒ–æ—¥ç¨‹è¡¨
            if (!schedules['default']) {
                schedules['default'] = {};
            }
            
            // ä»DOMä¸­è¯»å–ç°æœ‰ä»»åŠ¡
            const taskRows = document.querySelectorAll('.task-row');
            taskRows.forEach((row, index) => {
                const task = {
                    id: index,
                    element: row,
                    completed: false,
                    week: row.dataset.week,
                    phase: row.closest('.phase-section').dataset.phase,
                    title: row.querySelector('.task-title').textContent,
                    description: row.querySelector('.task-desc').textContent,
                    type: row.querySelectorAll('.task-cell')[2].textContent,
                    source: row.querySelector('.data-source').textContent
                };
                plans['default'].tasks.push(task);
            });
            
            updateProgress();
        }

        // è®¡åˆ’ç®¡ç†
        function addNewPlan() {
            document.getElementById('addPlanModal').classList.add('show');
        }

        function hidePlanModal() {
            document.getElementById('addPlanModal').classList.remove('show');
            document.getElementById('addPlanForm').reset();
        }

        function createPlan(name, description) {
            const planId = 'plan_' + Date.now();
            plans[planId] = {
                name: name,
                description: description,
                tasks: []
            };
            
            // åˆå§‹åŒ–è¯¥è®¡åˆ’çš„æ—¥ç¨‹è¡¨
            if (!schedules[planId]) {
                schedules[planId] = {};
            }
            
            // æ·»åŠ è®¡åˆ’æ ‡ç­¾
            const tabsContainer = document.querySelector('.plan-tabs');
            const addBtn = tabsContainer.querySelector('.add-plan-btn');
            
            const newTab = document.createElement('div');
            newTab.className = 'plan-tab';
            newTab.dataset.plan = planId;
            newTab.innerHTML = `
                ${name}
                <span class="close-btn" onclick="event.stopPropagation(); closePlan('${planId}')">Ã—</span>
            `;
            newTab.onclick = () => switchPlan(planId);
            
            tabsContainer.insertBefore(newTab, addBtn);
            switchPlan(planId);
            
            savePlans();
        }

        function switchPlan(planId) {
            currentPlan = planId;
            
            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.plan-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.plan === planId) {
                    tab.classList.add('active');
                }
            });
            
            // æ˜¾ç¤º/éšè—å…³é—­æŒ‰é’®
            document.querySelectorAll('.close-btn').forEach(btn => {
                btn.style.display = planId === 'default' ? 'none' : 'inline-flex';
            });
            
            // é‡æ–°æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨å’Œæ—¥ç¨‹è¡¨
            renderPlanTasks();
            updateFilterButtons();
            updateProgress();
            generateScheduleTable(); // æ›´æ–°æ—¥ç¨‹è¡¨
        }

        function closePlan(planId) {
            if (planId === 'default') return;
            
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè®¡åˆ’å—ï¼Ÿæ‰€æœ‰ä»»åŠ¡æ•°æ®å’Œæ—¥ç¨‹å®‰æ’å°†è¢«åˆ é™¤ã€‚')) {
                delete plans[planId];
                delete schedules[planId]; // åŒæ—¶åˆ é™¤æ—¥ç¨‹æ•°æ®
                document.querySelector(`[data-plan="${planId}"]`).remove();
                
                if (currentPlan === planId) {
                    switchPlan('default');
                }
                savePlans();
                localStorage.setItem('researchSchedules', JSON.stringify(schedules));
                generateScheduleTable(); // é‡æ–°ç”Ÿæˆæ—¥ç¨‹è¡¨
            }
        }

        // ä»»åŠ¡ç®¡ç†
        function showAddTaskModal() {
            document.getElementById('addTaskModal').classList.add('show');
        }

        function hideAddTaskModal() {
            document.getElementById('addTaskModal').classList.remove('show');
            document.getElementById('addTaskForm').reset();
        }

        function addTask(taskData) {
            const task = {
                id: taskIdCounter++,
                completed: false,
                title: taskData.title,
                description: taskData.description,
                phase: taskData.phase,
                week: taskData.week,
                type: taskData.type,
                source: taskData.source
            };
            
            plans[currentPlan].tasks.push(task);
            renderPlanTasks();
            updateFilterButtons();
            updateProgress();
            savePlans();
        }

        function removeTask(taskId) {
            const plan = plans[currentPlan];
            plan.tasks = plan.tasks.filter(task => task.id !== taskId);
            renderPlanTasks();
            updateFilterButtons();
            updateProgress();
            savePlans();
        }

        function renderPlanTasks() {
            const plan = plans[currentPlan];
            
            // æ¸…ç©ºç°æœ‰ä»»åŠ¡ï¼ˆåªæ¸…ç©ºé¢„å®šä¹‰é˜¶æ®µï¼‰
            document.querySelectorAll('.phase-section[data-phase="datacollection"], .phase-section[data-phase="dataprocessing"], .phase-section[data-phase="calculation"], .phase-section[data-phase="others"]').forEach(section => {
                const taskGrid = section.querySelector('.task-grid');
                taskGrid.innerHTML = '';
            });
            
            // åˆ é™¤æ‰€æœ‰è‡ªå®šä¹‰é˜¶æ®µçš„section
            document.querySelectorAll('.phase-section:not([data-phase="datacollection"]):not([data-phase="dataprocessing"]):not([data-phase="calculation"]):not([data-phase="others"])').forEach(section => {
                section.remove();
            });
            
            // è·å–æ‰€æœ‰ç‹¬ç‰¹çš„é˜¶æ®µ
            const allPhases = [...new Set(plan.tasks.map(task => task.phase))].filter(phase => phase && phase.trim());
            
            // é¢„å®šä¹‰é˜¶æ®µæ˜ å°„ï¼ˆå‘åå…¼å®¹ï¼‰
            const legacyPhaseMap = {
                'datacollection': 'æ•°æ®æ”¶é›†',
                'dataprocessing': 'æ•°æ®å¤„ç†', 
                'calculation': 'æŒ‡æ ‡è®¡ç®—',
                'others': 'å…¶ä»–ä»»åŠ¡'
            };
            
            // ä¸ºæ¯ä¸ªé˜¶æ®µæ¸²æŸ“ä»»åŠ¡
            allPhases.forEach(phaseKey => {
                const phaseTasks = plan.tasks.filter(task => task.phase === phaseKey);
                let section = document.querySelector(`[data-phase="${phaseKey}"]`);
                
                // å¦‚æœæ˜¯é¢„å®šä¹‰é˜¶æ®µï¼Œä½¿ç”¨ç°æœ‰section
                if (!section) {
                    // åˆ›å»ºè‡ªå®šä¹‰é˜¶æ®µsection
                    const displayName = legacyPhaseMap[phaseKey] || phaseKey;
                    section = createCustomPhaseSection(phaseKey, displayName);
                    document.querySelector('.main-content').appendChild(section);
                }
                
                const taskGrid = section.querySelector('.task-grid');
                
                phaseTasks.forEach(task => {
                    const taskRow = createTaskElement(task);
                    taskGrid.appendChild(taskRow);
                });
            });
            
            // æ˜¾ç¤ºæœ‰ä»»åŠ¡çš„é¢„å®šä¹‰é˜¶æ®µï¼Œéšè—ç©ºçš„
            const predefinedSections = document.querySelectorAll('.phase-section[data-phase="datacollection"], .phase-section[data-phase="dataprocessing"], .phase-section[data-phase="calculation"], .phase-section[data-phase="others"]');
            predefinedSections.forEach(section => {
                const phaseKey = section.dataset.phase;
                const hasTasks = plan.tasks.some(task => task.phase === phaseKey);
                section.style.display = hasTasks ? 'block' : 'none';
            });
        }

        function createCustomPhaseSection(phaseKey, phaseName) {
            const section = document.createElement('div');
            section.className = 'phase-section fade-in';
            section.dataset.phase = phaseKey;
            
            section.innerHTML = `
                <div class="phase-header" onclick="togglePhase(this)">
                    <span>ğŸ“ ${phaseName}</span>
                    <span class="toggle-icon">â–¼</span>
                </div>
                <div class="phase-content">
                    <div class="task-grid"></div>
                </div>
            `;
            
            return section;
        }

        function createTaskElement(task) {
            const taskRow = document.createElement('div');
            taskRow.className = 'task-row';
            taskRow.dataset.week = task.week;
            if (task.completed) taskRow.classList.add('completed');
            
            taskRow.innerHTML = `
                <div class="task-cell">
                    <div class="checkbox ${task.completed ? 'checked' : ''}" onclick="toggleTask(${task.id})"></div>
                </div>
                <div class="task-cell">
                    <div>
                        <div class="task-title">${task.title}</div>
                        <div class="task-desc">${task.description}</div>
                    </div>
                </div>
                <div class="task-cell">${task.type}</div>
                <div class="task-cell">
                    <span class="data-source">${task.source}</span>
                    <button class="btn-remove" onclick="removeTask(${task.id})">ğŸ—‘ï¸</button>
                </div>
            `;
            
            return taskRow;
        }

        function toggleTask(taskId) {
            const plan = plans[currentPlan];
            const task = plan.tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                renderPlanTasks();
                updateProgress();
                savePlans();
            }
        }

        function updateFilterButtons() {
            const plan = plans[currentPlan];
            const controlsLeft = document.querySelector('.controls-left');
            
            // ç§»é™¤æ‰€æœ‰åŠ¨æ€æ·»åŠ çš„é˜¶æ®µè¿‡æ»¤æŒ‰é’®ï¼ˆä¿ç•™åŸºç¡€çš„é™æ€æŒ‰é’®ï¼‰
            controlsLeft.querySelectorAll('.filter-btn.phase-btn').forEach(btn => btn.remove());
            
            // è·å–æ‰€æœ‰ç‹¬ç‰¹çš„é˜¶æ®µ
            const allPhases = [...new Set(plan.tasks.map(task => task.phase))].filter(phase => phase && phase.trim());
            
            // é¢„å®šä¹‰é˜¶æ®µçš„ä¸­æ–‡æ˜ å°„
            const phaseNameMap = {
                'datacollection': 'æ•°æ®æ”¶é›†',
                'dataprocessing': 'æ•°æ®å¤„ç†', 
                'calculation': 'æŒ‡æ ‡è®¡ç®—',
                'others': 'å…¶ä»–ä»»åŠ¡'
            };
            
            // ä¸ºæ¯ä¸ªå®é™…å­˜åœ¨çš„é˜¶æ®µæ·»åŠ è¿‡æ»¤æŒ‰é’®
            const searchBox = controlsLeft.querySelector('.search-box');
            allPhases.forEach(phase => {
                const displayName = phaseNameMap[phase] || phase; // å¦‚æœæ˜¯é¢„å®šä¹‰çš„è‹±æ–‡é˜¶æ®µï¼Œè½¬æ¢ä¸ºä¸­æ–‡
                
                const btn = document.createElement('button');
                btn.className = 'filter-btn phase-btn';
                btn.innerHTML = `
                    <span>${displayName}</span>
                    <span class="delete-phase" onclick="event.stopPropagation(); deletePhase('${phase.replace(/'/g, "\\'")}')">Ã—</span>
                `;
                btn.onclick = () => filterTasks(phase);
                controlsLeft.insertBefore(btn, searchBox);
            });
        }

        // åˆ é™¤é˜¶æ®µåŠŸèƒ½
        function deletePhase(phaseName) {
            const plan = plans[currentPlan];
            const tasksInPhase = plan.tasks.filter(task => task.phase === phaseName);
            
            if (tasksInPhase.length > 0) {
                if (!confirm(`ç¡®å®šè¦åˆ é™¤é˜¶æ®µ"${phaseName}"å—ï¼Ÿè¿™å°†åˆ é™¤è¯¥é˜¶æ®µä¸‹çš„ ${tasksInPhase.length} ä¸ªä»»åŠ¡ã€‚`)) {
                    return;
                }
            }
            
            // åˆ é™¤è¯¥é˜¶æ®µçš„æ‰€æœ‰ä»»åŠ¡
            plan.tasks = plan.tasks.filter(task => task.phase !== phaseName);
            
            // åˆ é™¤å¯¹åº”çš„è‡ªå®šä¹‰é˜¶æ®µsection
            const customSection = document.querySelector(`[data-phase="${phaseName}"]`);
            if (customSection && !['datacollection', 'dataprocessing', 'calculation', 'others'].includes(customSection.dataset.phase)) {
                customSection.remove();
            }
            
            // é‡æ–°æ¸²æŸ“å’Œæ›´æ–°
            renderPlanTasks();
            updateFilterButtons();
            updateProgress();
            savePlans();
            
            // å¦‚æœå½“å‰è¿‡æ»¤çš„å°±æ˜¯è¢«åˆ é™¤çš„é˜¶æ®µï¼Œåˆ‡æ¢åˆ°å…¨éƒ¨ä»»åŠ¡
            if (currentFilter === phaseName) {
                filterTasks('all');
            }
        }

        // æ—¥ç¨‹è¡¨åŠŸèƒ½ï¼ˆè¯¾ç¨‹è¡¨æ ·å¼ï¼‰
        function showAddScheduleModal() {
            document.getElementById('addScheduleModal').classList.add('show');
        }

        function hideAddScheduleModal() {
            document.getElementById('addScheduleModal').classList.remove('show');
            document.getElementById('addScheduleForm').reset();
        }

        function generateScheduleTable() {
            const container = document.getElementById('scheduleContainer');
            container.innerHTML = '';
            
            // æ—¶é—´æ®µé…ç½®
            const timeConfig = {
                startHour: parseInt(localStorage.getItem('timeConfig_startHour') || 8),
                endHour: parseInt(localStorage.getItem('timeConfig_endHour') || 22),
                interval: parseInt(localStorage.getItem('timeConfig_interval') || 60)
            };
            
            // ç”Ÿæˆæ—¶é—´æ®µæ•°ç»„
            const timeSlots = [];
            const totalMinutes = (timeConfig.endHour - timeConfig.startHour) * 60;
            const slotCount = Math.floor(totalMinutes / timeConfig.interval);
            
            for (let i = 0; i <= slotCount; i++) {
                const currentMinutes = timeConfig.startHour * 60 + i * timeConfig.interval;
                const hours = Math.floor(currentMinutes / 60);
                const minutes = currentMinutes % 60;
                timeSlots.push(
                    `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`
                );
            }
            
            // æ˜ŸæœŸæ•°ç»„
            const weekdays = ['æ—¶é—´', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
            
            // ç”Ÿæˆè¡¨å¤´
            weekdays.forEach((day, index) => {
                const header = document.createElement('div');
                header.className = 'schedule-header';
                if (index === 0) {
                    header.textContent = day;
                } else {
                    const date = new Date(currentWeekStart);
                    date.setDate(currentWeekStart.getDate() + index - 1);
                    header.innerHTML = `
                        <div>${day}</div>
                        <div style="font-size: 12px; color: #86868B;">
                            ${date.getMonth() + 1}/${date.getDate()}
                        </div>
                    `;
                }
                container.appendChild(header);
            });
            
            // ç”Ÿæˆæ—¶é—´æ®µå’Œå•å…ƒæ ¼
            timeSlots.forEach(timeSlot => {
                // æ—¶é—´åˆ—
                const timeCell = document.createElement('div');
                timeCell.className = 'schedule-time-slot';
                timeCell.textContent = timeSlot;
                container.appendChild(timeCell);
                
                // æ¯ä¸€å¤©çš„å•å…ƒæ ¼
                for (let day = 1; day <= 7; day++) {
                    const cell = document.createElement('div');
                    cell.className = 'schedule-cell';
                    cell.dataset.day = day === 7 ? 0 : day; // å‘¨æ—¥ä¸º0
                    cell.dataset.time = timeSlot;
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰å®‰æ’
                    const tasks = getTasksForTimeSlot(day === 7 ? 0 : day, timeSlot);
                    if (tasks.length > 0) {
                        cell.classList.add('has-task');
                        tasks.forEach(task => {
                            const taskElement = document.createElement('div');
                            taskElement.className = `schedule-task priority-${task.priority}`;
                            taskElement.textContent = task.title;
                            taskElement.onclick = (e) => {
                                e.stopPropagation();
                                removeScheduleTask(day === 7 ? 0 : day, timeSlot, task.id);
                            };
                            cell.appendChild(taskElement);
                        });
                    }
                    
                    cell.onclick = () => selectTimeSlot(day === 7 ? 0 : day, timeSlot);
                    container.appendChild(cell);
                }
            });
            
            updateWeekDisplay();
            createTimeConfigPanel();
        }

        // åˆ›å»ºæ—¶é—´é…ç½®é¢æ¿
        function createTimeConfigPanel() {
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨é…ç½®é¢æ¿
            let configPanel = document.getElementById('timeConfigPanel');
            if (!configPanel) {
                configPanel = document.createElement('div');
                configPanel.id = 'timeConfigPanel';
                configPanel.className = 'config-section ios-card';
                configPanel.innerHTML = `
                    <div class="section-header bg-primary text-white p-2 rounded-top">
                        <i class="bi bi-clock me-2"></i>
                        <span class="h5">æ—¶é—´é…ç½®</span>
                        <button class="ios-icon-btn" onclick="toggleTimeConfig()">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M17 13L12 18L7 13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                <path d="M17 11L12 6L7 11" stroke="currentColor" stroke-width="2" stroke-linecap="round" class="collapse-icon"/>
                            </svg>
                        </button>
                    </div>
                    <div class="config-content p-3 border">
                        <div class="row g-3 mb-3">
                            <div class="col-md-4">
                                <label class="form-label">å¼€å§‹æ—¶é—´</label>
                                <input type="number" class="form-control form-control-sm" 
                                    id="configStart" min="0" max="24" 
                                    value="${localStorage.getItem('timeConfig_startHour') || 8}">
                            </div>
                <div class="config-item">
                    <label>ç»“æŸæ—¶é—´ï¼š
                        <input type="number" id="configEnd" min="0" max="24" value="22">
                    </label>
                </div>
                <div class="config-item">
                    <label>é—´éš”(åˆ†é’Ÿ)ï¼š
                        <select id="configInterval">
                            <option value="15">15åˆ†é’Ÿ</option>
                            <option value="30">30åˆ†é’Ÿ</option>
                            <option value="60" selected>1å°æ—¶</option>
                        </select>
                    </label>
                </div>
                <button onclick="applyTimeConfig()">åº”ç”¨è®¾ç½®</button>
            `;
                document.getElementById('scheduleContainer').insertAdjacentElement('beforebegin', configPanel);
            }
            
            function toggleTimeConfig() {
                const content = document.querySelector('#timeConfigPanel .config-content');
                content.style.display = content.style.display === 'none' ? 'block' : 'none';
            }
        }

        function applyTimeConfig() {
            // å¼ºåˆ¶é‡ç½®å½“å‰å‘¨è§†å›¾
            currentWeekStart = new Date(currentWeekStart.setHours(0,0,0,0));
            
            // æ›´æ–°å­˜å‚¨é…ç½®
            localStorage.setItem('timeConfig_startHour', document.getElementById('configStart').value);
            localStorage.setItem('timeConfig_endHour', document.getElementById('configEnd').value);
            localStorage.setItem('timeConfig_interval', document.getElementById('configInterval').value);
            
            // æ¸…é™¤æ—§æ—¥ç¨‹è¡¨
            const container = document.getElementById('scheduleContainer');
            container.innerHTML = '';
            
            // é‡æ–°ç”Ÿæˆç»„ä»¶
            generateScheduleTable();
            updateAllScheduleTasks();
            savePlans();
            
            // åˆ·æ–°å‘¨æ˜¾ç¤º
            updateWeekDisplay();
            
            if(newConfig.startHour >= newConfig.endHour) {
                alert('ç»“æŸæ—¶é—´å¿…é¡»æ™šäºå¼€å§‹æ—¶é—´');
                return;
            }
            
            localStorage.setItem('timeConfig', JSON.stringify(newConfig));
            // å¼ºåˆ¶é‡æ–°åˆå§‹åŒ–
            currentWeekStart = new Date();
            generateScheduleTable();
            updateAllScheduleTasks();
        }

        function getTasksForTimeSlot(weekday, timeSlot) {
            if (!schedules[currentPlan] || !schedules[currentPlan][weekday]) {
                return [];
            }
            
            return schedules[currentPlan][weekday].filter(task => {
                const taskStartHour = parseInt(task.startTime.split(':')[0]);
                const slotHour = parseInt(timeSlot.split(':')[0]);
                const taskEndHour = parseInt(task.endTime.split(':')[0]);
                
                return slotHour >= taskStartHour && slotHour < taskEndHour;
            });
        }

        function selectTimeSlot(weekday, timeSlot) {
            selectedTimeSlot = { weekday, timeSlot };
            
            // è®¾ç½®æ·»åŠ æ—¥ç¨‹è¡¨å•çš„é»˜è®¤å€¼
            document.getElementById('scheduleWeekday').value = weekday;
            document.getElementById('scheduleStartTime').value = timeSlot;
            
            // è®¡ç®—ç»“æŸæ—¶é—´ï¼ˆé»˜è®¤1å°æ—¶åï¼‰
            const startHour = parseInt(timeSlot.split(':')[0]);
            const endTime = `${(startHour + 1).toString().padStart(2, '0')}:00`;
            document.getElementById('scheduleEndTime').value = endTime;
            
            showAddScheduleModal();
        }

        function changeWeek(direction) {
            currentWeekStart.setDate(currentWeekStart.getDate() + direction * 7);
            generateScheduleTable();
        }

        function updateWeekDisplay() {
            const weekEnd = new Date(currentWeekStart);
            weekEnd.setDate(currentWeekStart.getDate() + 6);
            
            const formatDate = (date) => {
                return `${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥`;
            };
            
            document.getElementById('currentWeekDisplay').textContent = 
                `${currentWeekStart.getFullYear()}å¹´${formatDate(currentWeekStart)} - ${formatDate(weekEnd)}`;
        }

        function addScheduleTask(taskData) {
            if (!schedules[currentPlan]) {
                schedules[currentPlan] = {};
            }
            
            const weekday = parseInt(taskData.weekday);
            if (!schedules[currentPlan][weekday]) {
                schedules[currentPlan][weekday] = [];
            }
            
            const task = {
                id: Date.now(),
                title: taskData.title,
                description: taskData.description,
                startTime: taskData.startTime,
                endTime: taskData.endTime,
                priority: taskData.priority
            };
            
            schedules[currentPlan][weekday].push(task);
            localStorage.setItem('researchSchedules', JSON.stringify(schedules));
            generateScheduleTable();
        }

        function removeScheduleTask(weekday, timeSlot, taskId) {
            if (schedules[currentPlan] && schedules[currentPlan][weekday]) {
                schedules[currentPlan][weekday] = schedules[currentPlan][weekday].filter(task => task.id !== taskId);
                
                if (schedules[currentPlan][weekday].length === 0) {
                    delete schedules[currentPlan][weekday];
                }
                
                localStorage.setItem('researchSchedules', JSON.stringify(schedules));
                generateScheduleTable();
            }
        }

        function updateProgress() {
            const plan = plans[currentPlan];
            
            // æ›´æ–°é¢„å®šä¹‰å‘¨æ¬¡çš„è¿›åº¦ï¼ˆå…¼å®¹æ—§æ•°æ®å’Œæ–°æ•°æ®ï¼‰
            const weeks = ['week1', 'week2', 'week3', 'week4'];
            const weekMapping = {
                'week1': ['1', 'ç¬¬ä¸€å‘¨'],
                'week2': ['2', 'ç¬¬äºŒ-ä¸‰å‘¨'], 
                'week3': ['3', 'ç¬¬å››å‘¨'],
                'week4': ['4', 'å…¶ä»–æ—¶é—´']
            };
            
            weeks.forEach((week, index) => {
                const acceptableWeeks = weekMapping[week];
                const weekTasks = plan.tasks.filter(task => acceptableWeeks.includes(task.week));
                const completed = weekTasks.filter(task => task.completed).length;
                const total = weekTasks.length;
                const percentage = total > 0 ? (completed / total) * 100 : 0;
                
                const completedEl = document.getElementById(`${week}-completed`);
                const totalEl = document.getElementById(`${week}-total`);
                const progressEl = document.getElementById(`${week}-progress`);
                
                if (completedEl) completedEl.textContent = completed;
                if (totalEl) totalEl.textContent = total;
                if (progressEl) progressEl.style.width = percentage + '%';
            });

            // æ›´æ–°æ€»ä½“ç»Ÿè®¡
            const totalTasks = plan.tasks.length;
            const completedTasks = plan.tasks.filter(task => task.completed).length;
            const pendingTasks = totalTasks - completedTasks;
            const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

            document.getElementById('total-tasks').textContent = totalTasks;
            document.getElementById('completed-tasks').textContent = completedTasks;
            document.getElementById('pending-tasks').textContent = pendingTasks;
            document.getElementById('completion-rate').textContent = completionRate + '%';
        }

        // è¿‡æ»¤å’Œæœç´¢
        function filterTasks(filter) {
            currentFilter = filter;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // æ‰¾åˆ°å¯¹åº”çš„æŒ‰é’®å¹¶æ¿€æ´»
            if (filter === 'all') {
                document.querySelector('.filter-btn[onclick="filterTasks(\'all\')"]').classList.add('active');
            } else if (filter === 'completed') {
                document.querySelector('.filter-btn[onclick="filterTasks(\'completed\')"]').classList.add('active');
            } else if (filter === 'pending') {
                document.querySelector('.filter-btn[onclick="filterTasks(\'pending\')"]').classList.add('active');
            } else {
                // è‡ªå®šä¹‰é˜¶æ®µ - é€šè¿‡onclickå±æ€§æŸ¥æ‰¾å¯¹åº”æŒ‰é’®
                const phaseBtn = Array.from(document.querySelectorAll('.phase-btn')).find(btn => {
                    const onclickAttr = btn.getAttribute('onclick');
                    return onclickAttr && onclickAttr.includes(`filterTasks('${filter}')`);
                });
                if (phaseBtn) phaseBtn.classList.add('active');
            }

            const plan = plans[currentPlan];
            
            plan.tasks.forEach(task => {
                const taskElement = document.querySelector(`[onclick="toggleTask(${task.id})"]`)?.closest('.task-row');
                if (taskElement) {
                    let show = true;
                    
                    switch(filter) {
                        case 'completed':
                            show = task.completed;
                            break;
                        case 'pending':
                            show = !task.completed;
                            break;
                        case 'all':
                            show = true;
                            break;
                        default:
                            // è‡ªå®šä¹‰é˜¶æ®µè¿‡æ»¤
                            show = task.phase === filter;
                    }
                    
                    taskElement.style.display = show ? 'grid' : 'none';
                }
            });

            // éšè—ç©ºçš„é˜¶æ®µ
            document.querySelectorAll('.phase-section').forEach(section => {
                const visibleTasks = section.querySelectorAll('.task-row:not([style*="display: none"])');
                section.style.display = visibleTasks.length > 0 ? 'block' : 'none';
            });
        }

        function searchTasks(query) {
            const searchTerm = query.toLowerCase();
            const plan = plans[currentPlan];
            
            plan.tasks.forEach(task => {
                const taskElement = document.querySelector(`[onclick="toggleTask(${task.id})"]`)?.closest('.task-row');
                if (taskElement) {
                    const titleMatch = task.title.toLowerCase().includes(searchTerm);
                    const descMatch = task.description.toLowerCase().includes(searchTerm);
                    const shouldShow = (titleMatch || descMatch) && (currentFilter === 'all' || 
                        (currentFilter === 'completed' && task.completed) ||
                        (currentFilter === 'pending' && !task.completed) ||
                        (task.phase === currentFilter));
                    
                    taskElement.style.display = shouldShow ? 'grid' : 'none';
                }
            });
        }

        function togglePhase(header) {
            const content = header.nextElementSibling;
            const icon = header.querySelector('.toggle-icon');
            
            content.classList.toggle('collapsed');
            icon.style.transform = content.classList.contains('collapsed') ? 'rotate(-90deg)' : 'rotate(0deg)';
        }

        // æ•°æ®æŒä¹…åŒ–
        function savePlans() {
            // å°†DOMå…ƒç´ ä»ä»»åŠ¡ä¸­ç§»é™¤ï¼Œåªä¿å­˜æ•°æ®
            const plansToSave = {};
            Object.keys(plans).forEach(planId => {
                plansToSave[planId] = {
                    name: plans[planId].name,
                    description: plans[planId].description,
                    tasks: plans[planId].tasks.map(task => ({
                        id: task.id,
                        completed: task.completed,
                        title: task.title,
                        description: task.description,
                        phase: task.phase,
                        week: task.week,
                        type: task.type,
                        source: task.source
                    }))
                };
            });
            
            localStorage.setItem('researchPlans', JSON.stringify(plansToSave));
            localStorage.setItem('currentPlan', currentPlan);
        }

        function loadPlans() {
            const saved = localStorage.getItem('researchPlans');
            const savedCurrentPlan = localStorage.getItem('currentPlan');
            const savedSchedules = localStorage.getItem('researchSchedules');
            
            if (savedSchedules) {
                schedules = JSON.parse(savedSchedules);
            }
            
            if (saved) {
                plans = JSON.parse(saved);
                
                // é‡å»ºè®¡åˆ’æ ‡ç­¾
                const tabsContainer = document.querySelector('.plan-tabs');
                const addBtn = tabsContainer.querySelector('.add-plan-btn');
                
                // æ¸…é™¤ç°æœ‰æ ‡ç­¾ï¼ˆé™¤äº†é»˜è®¤å’Œæ·»åŠ æŒ‰é’®ï¼‰
                tabsContainer.querySelectorAll('.plan-tab:not([data-plan="default"])').forEach(tab => tab.remove());
                
                // æ·»åŠ ä¿å­˜çš„è®¡åˆ’æ ‡ç­¾
                Object.keys(plans).forEach(planId => {
                    if (planId !== 'default') {
                        const newTab = document.createElement('div');
                        newTab.className = 'plan-tab';
                        newTab.dataset.plan = planId;
                        newTab.innerHTML = `
                            ${plans[planId].name}
                            <span class="close-btn" onclick="event.stopPropagation(); closePlan('${planId}')">Ã—</span>
                        `;
                        newTab.onclick = () => switchPlan(planId);
                        tabsContainer.insertBefore(newTab, addBtn);
                    }
                });
                
                // åˆ‡æ¢åˆ°ä¸Šæ¬¡ä½¿ç”¨çš„è®¡åˆ’
                if (savedCurrentPlan && plans[savedCurrentPlan]) {
                    switchPlan(savedCurrentPlan);
                } else {
                    switchPlan('default');
                }
            } else {
                switchPlan('default');
            }
        }

        // è¡¨å•äº‹ä»¶å¤„ç†
        document.getElementById('addTaskForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const taskData = {
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDesc').value,
                phase: document.getElementById('taskPhase').value,
                week: document.getElementById('taskWeek').value,
                type: document.getElementById('taskType').value,
                source: document.getElementById('taskSource').value
            };
            
            addTask(taskData);
            hideAddTaskModal();
        });

        document.getElementById('addPlanForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('planName').value;
            const description = document.getElementById('planDesc').value;
            
            createPlan(name, description);
            hidePlanModal();
        });

        document.getElementById('addScheduleForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const taskData = {
                title: document.getElementById('scheduleTitle').value,
                description: document.getElementById('scheduleDesc').value,
                weekday: document.getElementById('scheduleWeekday').value,
                startTime: document.getElementById('scheduleStartTime').value,
                endTime: document.getElementById('scheduleEndTime').value,
                priority: document.getElementById('schedulePriority').value
            };
            
            // éªŒè¯æ—¶é—´
            if (taskData.startTime >= taskData.endTime) {
                alert('ç»“æŸæ—¶é—´å¿…é¡»æ™šäºå¼€å§‹æ—¶é—´ï¼');
                return;
            }
            
            addScheduleTask(taskData);
            hideAddScheduleModal();
        });

        // å…³é—­æ¨¡æ€æ¡†ï¼ˆç‚¹å‡»å¤–éƒ¨ï¼‰
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.classList.remove('show');
                }
            });
        });

        function updateProgress() { 
            const plan = plans[currentPlan]; 
            
            // åŠ¨æ€ç”Ÿæˆè¿›åº¦å¡ç‰‡ 
            generateProgressCards(); 

            // æ›´æ–°æ€»ä½“ç»Ÿè®¡ 
            const totalTasks = plan.tasks.length; 
            const completedTasks = plan.tasks.filter(task => task.completed).length; 
            const pendingTasks = totalTasks - completedTasks; 
            const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0; 

            document.getElementById('total-tasks').textContent = totalTasks; 
            document.getElementById('completed-tasks').textContent = completedTasks; 
            document.getElementById('pending-tasks').textContent = pendingTasks; 
            document.getElementById('completion-rate').textContent = completionRate + '%'; 
        } 

        function generateProgressCards() { 
            const plan = plans[currentPlan]; 
            const progressGrid = document.querySelector('.progress-grid'); 
            
            // æ¸…ç©ºç°æœ‰è¿›åº¦å¡ç‰‡ 
            progressGrid.innerHTML = ''; 
            
            // è·å–æ‰€æœ‰ç‹¬ç‰¹çš„é˜¶æ®µ 
            const allPhases = [...new Set(plan.tasks.map(task => task.phase))].filter(phase => phase && phase.trim()); 
            
            // é¢„å®šä¹‰é˜¶æ®µçš„æ˜ å°„å’Œé¢œè‰² 
            const phaseConfig = { 
                'datacollection': { 
                    name: 'æ•°æ®æ”¶é›†', 
                    color: 'week1', 
                    icon: 'ğŸ“Š' 
                }, 
                'dataprocessing': { 
                    name: 'æ•°æ®å¤„ç†', 
                    color: 'week2', 
                    icon: 'âš™ï¸' 
                }, 
                'calculation': { 
                    name: 'æŒ‡æ ‡è®¡ç®—', 
                    color: 'week3', 
                    icon: 'ğŸ“ˆ' 
                }, 
                'others': { 
                    name: 'å…¶ä»–ä»»åŠ¡', 
                    color: 'week4', 
                    icon: 'ğŸ”§' 
                } 
            }; 
            
            // ä¸ºæ¯ä¸ªé˜¶æ®µç”Ÿæˆè¿›åº¦å¡ç‰‡ 
            allPhases.forEach((phase, index) => { 
                const phaseTasks = plan.tasks.filter(task => task.phase === phase); 
                const completed = phaseTasks.filter(task => task.completed).length; 
                const total = phaseTasks.length; 
                const percentage = total > 0 ? (completed / total) * 100 : 0; 
                
                // è·å–é˜¶æ®µé…ç½®ï¼Œå¦‚æœæ˜¯è‡ªå®šä¹‰é˜¶æ®µï¼Œä½¿ç”¨é»˜è®¤é…ç½® 
                const config = phaseConfig[phase] || { 
                    name: phase, 
                    color: `custom-${index % 4}`, 
                    icon: 'ğŸ“' 
                }; 
                
                // åˆ›å»ºè¿›åº¦å¡ç‰‡ 
                const progressCard = document.createElement('div'); 
                progressCard.className = `progress-card ${config.color}`; 
                progressCard.innerHTML = ` 
                    <h3>${config.icon} ${config.name}</h3> 
                    <div class="progress-bar"> 
                        <div class="progress-fill" style="width: ${percentage}%"></div> 
                    </div> 
                    <div><span>${completed}</span> / <span>${total}</span> é¡¹ä»»åŠ¡</div> 
                `; 
                
                progressGrid.appendChild(progressCard); 
            }); 
            
            // å¦‚æœæ²¡æœ‰ä»»åŠ¡ï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€ 
            if (allPhases.length === 0) { 
                const emptyCard = document.createElement('div'); 
                emptyCard.className = 'progress-card'; 
                emptyCard.innerHTML = ` 
                    <h3>ğŸ“‹ æš‚æ— ä»»åŠ¡</h3> 
                    <div class="progress-bar"> 
                        <div class="progress-fill" style="width: 0%"></div> 
                    </div> 
                    <div>0 / 0 é¡¹ä»»åŠ¡</div> 
                `; 
                progressGrid.appendChild(emptyCard); 
            } 
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initCurrentWeek();
            initializeDefaultPlan();
            loadPlans();
            updateFilterButtons();
            generateScheduleTable(); // åˆå§‹åŒ–æ—¥ç¨‹è¡¨æ˜¾ç¤º
            
            // æ·»åŠ æ·¡å…¥åŠ¨ç”»
            document.querySelectorAll('.phase-section').forEach((section, index) => {
                setTimeout(() => {
                    section.classList.add('fade-in');
                }, index * 200);
            });
        });

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                savePlans();
                alert('è¿›åº¦å·²ä¿å­˜ï¼');
            }
            
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal.show').forEach(modal => {
                    modal.classList.remove('show');
                });
            }
        });
    </script>
</body>
</html>